<script type="text/javascript">
//<![CDATA[

  // jQuery version
  function over(element) {
    element.setStyle({opacity: 1.0});
  }
  function init_miles() {
    $('*[mile]').each(function(index) {

    //todo: display: none at first, and then reveal later.
    var html = '<div id="mile_'+index+'" style="z-index: <%= options[:z_index] %>; position: absolute; background-color: <%= options[:background_color] %>; opacity: 0.4; filter: alpha(opacity=40); color: #eee; font-family: Lucida Sans, Helvetica; font-size: 16px; font-weight: bold; white-space: nowrap; overflow: hidden;"><p style="padding: 3px 5px; background-color: <%= options[:background_color] %>; opacity: 1.0; filter: alpha(opacity=100); display: inline; color: #f3f3f3;">'+this.getAttribute('mile')+'</p></div>'

    //clone the element so that we can overlay it
    // var overlay_element = $(this).clone();

    //insert before the element in question
    $(this).after(html);

    var overlay_element = $('mile_'+index);

    // replace the clone's html with our html
    $(overlay_element).replaceWith(html);

    //set the height
    var height = $(this).height();
    var width = $(this).width();

    $(overlay_element).height(height);
    $(overlay_element).width(width);

    //set the position
    var pos = $(this).position();
    $(overlay_element).css("top", pos.top);
    $(overlay_element).css("left", pos.left);

//    $(overlay_element).text( "left: " + pos.left + ", top: " + pos.top );

//       new Insertion.Before($(block), html);
//       Position.clone($(block), $('mile_'+index));
//       if($('mile_'+index).getHeight() <= 25) { $('mile_'+index).setStyle({fontSize: '10px'}); }
//       $('mile_'+index).observe("mouseover", function(event) {
//         element = Event.element(event); 
//         if(element.immediateDescendants()[0]) 
//         {
//           element.setStyle({opacity: 0.75});
//           if(element.style.filters) element.style.filters.alpha.opacity=75; 
//         }
//         else
//         {
//           element.up().setStyle({opacity: 0.75}); 
//           if(element.up().style.filters) element.up().style.filters.alpha.opacity=75; 
//         }
//       });
//       $('mile_'+index).observe("mouseout", function(event) {
//         element = Event.element(event); 
//         if(element.immediateDescendants()[0]) 
//         {
//           element.setStyle({opacity: 0.4}); 
//           if(element.style.filters) element.style.filters.alpha.opacity=40; 
//         }
//         else
//         {
//           element.up().setStyle({opacity: 0.4}); 
//           if(element.up().style.filters) element.up().style.filters.alpha.opacity=40; 
//         }
//       });
//       $('mile_'+index).toggle();
    });
  }

  $(document).ready(init_miles);
</script>

